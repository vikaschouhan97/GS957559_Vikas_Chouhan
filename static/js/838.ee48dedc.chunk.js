"use strict";(self.webpackChunkmy_ts_app=self.webpackChunkmy_ts_app||[]).push([[838,565],{1838:(e,t,a)=>{a.r(t),a.d(t,{default:()=>h});var l=a(2791),r=a(7601),n=a(4045),o=a(1565),s=a(2643),i=a(4420),c=a(3763),d=a(184);const h=()=>{const[e,t]=(0,l.useState)({}),[a,h]=(0,l.useState)(""),{storeData:u,fileAdded:f}=(0,i.v9)((e=>e.fileData)),p=(0,i.I0)();(0,l.useEffect)((()=>{m()}),[]),(0,l.useEffect)((()=>{m()}),[f]);const m=async()=>{const e=localStorage.getItem("file");let a;if(e){const t=JSON.parse(e),l=atob(t.split(",")[1]),r=new Array(l.length);for(let e=0;e<l.length;e++)r[e]=l.charCodeAt(e);const n=new Uint8Array(r);a=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})}else{const e=await fetch(c.Ye);a=await e.blob()}if(!a)return;const l=new FileReader;l.onload=e=>{var a;const l=new Uint8Array(null===(a=e.target)||void 0===a?void 0:a.result),r=n.ij(l,{type:"array"}),o=n.P6.sheet_to_json(r.Sheets.Planning,{header:1}),i=n.P6.sheet_to_json(r.Sheets.SKUs,{header:1}),c=r.Sheets.Stores,d=n.P6.sheet_to_json(c).map(((e,t)=>({seqNo:e["Seq No."]||t+1,ID:e.ID,Label:e.Label,City:e.City,State:e.State})));p((0,s.og)(d));const u=i.reduce(((e,t)=>(e[t[0]]={price:t[4],cost:t[5]},e)),{}),f={};for(let t=1;t<o.length;t++){const[e,a,l,r]=o[t];if(!u[a])continue;const{price:n,cost:s}=u[a],i=r*n,c=i-r*s,d=i?c/i:0;f[e]||(f[e]={}),f[e][l]||(f[e][l]={gmDollars:0,gmPercent:0,count:0}),f[e][l].gmDollars+=c,f[e][l].gmPercent+=d,f[e][l].count++}const m={};Object.keys(f).forEach((e=>{m[e]=Object.keys(f[e]).map((t=>({week:t,gmDollars:f[e][t].gmDollars,gmPercent:f[e][t].gmPercent/f[e][t].count})))})),t(m),h(Object.keys(m)[0]||"")},l.readAsArrayBuffer(a)},y={title:{text:"Gross Margin"},data:e[a]||[],series:[{type:"bar",xKey:"week",yKey:"gmDollars",yName:"GM Dollars"},{type:"line",xKey:"week",yKey:"gmPercent",yName:"GM %"}],axes:[{type:"category",position:"bottom",label:{rotation:-90}},{type:"number",position:"left",keys:["gmDollars"],tick:{count:10}},{type:"number",position:"right",keys:["gmPercent"],label:{format:".0%"},tick:{count:10}}]};return(0,d.jsx)(o.MainWrapper,{children:(0,d.jsx)("div",{style:{width:"100%",height:"100%"},children:Object.keys(e).length>0&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("label",{children:"Select Store: "}),(0,d.jsx)("select",{value:a,onChange:e=>h(e.target.value),children:Object.keys(e).map((e=>{var t;return(0,d.jsx)("option",{value:e,children:null===u||void 0===u||null===(t=u.find((t=>t.ID===e)))||void 0===t?void 0:t.Label},e)}))}),(0,d.jsx)(r.bY,{options:y,style:{width:"100%",height:"95%"}})]})})})}},1565:(e,t,a)=>{a.r(t),a.d(t,{MainWrapper:()=>f,default:()=>p});var l=a(2791),r=a(3614),n=a(9633),o=a(6934),s=a(6029),i=a(4045),c=a(4420),d=a(2643),h=a(3763),u=a(184);n.O3h.registerModules([n.wUi,n.yir,n.imY,n.ICW]);const f=(0,o.ZP)(s.Z)((()=>({width:"100%",marginLeft:"170px",height:"93%",marginTop:"60px",padding:"16px",background:"#d0d0d0"}))),p=()=>{var e,t;const a=(0,c.I0)(),[o]=(0,l.useState)(0),[s,p]=(0,l.useState)(null),{calendarData:m,fileAdded:y}=(0,c.v9)((e=>e.fileData));(0,l.useEffect)((()=>{s&&g({api:s})}),[y,s]);const g=async e=>{p(e.api);try{const e=localStorage.getItem("file");let t;if(e){const a=JSON.parse(e),l=atob(a.split(",")[1]),r=new Array(l.length);for(let e=0;e<l.length;e++)r[e]=l.charCodeAt(e);const n=new Uint8Array(r);t=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})}else{const e=await fetch(h.Ye);t=await e.blob()}if(!t)return;const l=new FileReader;l.readAsArrayBuffer(t),l.onload=e=>{var t;const l=null===(t=e.target)||void 0===t?void 0:t.result,r=i.ij(new Uint8Array(l),{type:"array"}),n=r.Sheets.Calendar,o=i.P6.sheet_to_json(n),s=r.Sheets.Planning,c=i.P6.sheet_to_json(s),h=r.Sheets.SKUs,u=i.P6.sheet_to_json(h),f={};u.forEach((e=>{let{ID:t,Label:a,Price:l,Cost:r}=e;f[t]={price:parseFloat(l),Label:a,cost:parseFloat(r)}}));const p=r.Sheets.Stores,m=i.P6.sheet_to_json(p),y={};m.forEach((e=>{let{ID:t,Label:a}=e;y[t]=a}));const g=[],S=[],b={};o.forEach((e=>{const{"Month Label":t,"Week Label":a,Week:l}=e;g.includes(t)||g.push(t),S.includes(l)||S.push(l),b[t]||(b[t]={headerName:t,children:[]});let r=b[t].children.find((e=>e.week===l));r||(r={headerName:a,week:l,children:[]},b[t].children.push(r))})),c.forEach((e=>{let{Store:t,SKU:a,Week:l,"Sales Units":r}=e;const n=f[a].price||0,o=f[a].cost||0,s=f[a].Label,i=y[t],c=n*r,d=c-r*o,h=Math.trunc(d/c*100)||0;Object.values(b).forEach((e=>{const n=e.children.find((e=>e.week===l));n&&n.children.push({Store:t,SKU:a,SalesUnits:r,SalesDollar:c.toFixed(2),skuLabel:s,storeLabel:i,gmDollar:d.toFixed(2),gmPercent:h})}))}));const v=g.map((e=>b[e])).filter(Boolean).map((e=>({...e,children:e.children.sort(((e,t)=>S.indexOf(e.week)-S.indexOf(t.week)))})));a((0,d.k2)(v))}}catch(t){console.error("Error fetching data:",t)}},[S,b]=(0,l.useState)((null===(e=m[o])||void 0===e||null===(t=e.children)||void 0===t?void 0:t.map((e=>[...e.children])).flat())||[]);(0,l.useEffect)((()=>{var e,t;b((null===(e=m[o])||void 0===e||null===(t=e.children)||void 0===t?void 0:t.map((e=>[...e.children])).flat())||[])}),[m]);const v=[{headerName:"Store",field:"storeLabel",pinned:"left",width:250},{headerName:"SKU",field:"skuLabel",pinned:"left",width:250},...(null!==m&&void 0!==m?m:[]).map((e=>{var t;return{headerName:e.headerName,children:(null!==(t=e.children)&&void 0!==t?t:[]).map((e=>({headerName:e.headerName,children:[{headerName:"Sales Units",field:"SalesUnits",cellStyle:h.hD,width:130},{headerName:"Sales Dollars",field:"SalesDollar",valueFormatter:e=>"$".concat(e.value),cellStyle:h.hD,width:130},{headerName:"GM Dollars",field:"gmDollar",valueFormatter:e=>"$".concat(e.value),cellStyle:h.hD,width:130},{headerName:"GM Percent",field:"gmPercent",valueFormatter:e=>"".concat(e.value,"%"),cellStyle:h.hD,cellClassRules:h.e_,width:130}]})))}}))];return(0,u.jsx)(f,{children:(0,u.jsx)(r.s,{rowData:S,columnDefs:v,modules:[n.ICW],debug:!0,defaultColDef:h.KR,onGridReady:g})})}}}]);
//# sourceMappingURL=838.ee48dedc.chunk.js.map