"use strict";(self.webpackChunkmy_ts_app=self.webpackChunkmy_ts_app||[]).push([[838,565],{1838:(e,t,a)=>{a.r(t),a.d(t,{default:()=>d});var l=a(2791),r=a(7601),n=a(4045),o=a(1565),s=a(2643),i=a(4420),c=a(184);const d=()=>{const[e,t]=(0,l.useState)({}),[a,d]=(0,l.useState)(""),{storeData:h}=(0,i.v9)((e=>e.fileData)),u=(0,i.I0)(),m={title:{text:"Gross Margin"},data:e[a]||[],series:[{type:"bar",xKey:"week",yKey:"gmDollars",yName:"GM Dollars"},{type:"line",xKey:"week",yKey:"gmPercent",yName:"GM %"}],axes:[{type:"category",position:"bottom",label:{rotation:-90}},{type:"number",position:"left",keys:["gmDollars"],tick:{count:10}},{type:"number",position:"right",keys:["gmPercent"],label:{format:".0%"},tick:{count:10}}]};return(0,c.jsx)(o.MainWrapper,{children:(0,c.jsxs)("div",{style:{width:"100%",height:"100%"},children:[(0,c.jsx)("input",{type:"file",accept:".xlsx,.xls",onChange:e=>{var a;const l=null===(a=e.target.files)||void 0===a?void 0:a[0];if(!l)return;const r=new FileReader;r.onload=e=>{var a;const l=new Uint8Array(null===(a=e.target)||void 0===a?void 0:a.result),r=n.ij(l,{type:"array"}),o=n.P6.sheet_to_json(r.Sheets.Planning,{header:1}),i=n.P6.sheet_to_json(r.Sheets.SKUs,{header:1}),c=r.Sheets.Stores,h=n.P6.sheet_to_json(c).map(((e,t)=>({seqNo:e["Seq No."]||t+1,ID:e.ID,Label:e.Label,City:e.City,State:e.State})));u((0,s.og)(h));const m=i.reduce(((e,t)=>(e[t[0]]={price:t[4],cost:t[5]},e)),{}),p={};for(let t=1;t<o.length;t++){const[e,a,l,r]=o[t];if(!m[a])continue;const{price:n,cost:s}=m[a],i=r*n,c=i-r*s,d=i?c/i:0;p[e]||(p[e]={}),p[e][l]||(p[e][l]={gmDollars:0,gmPercent:0,count:0}),p[e][l].gmDollars+=c,p[e][l].gmPercent+=d,p[e][l].count++}const f={};Object.keys(p).forEach((e=>{f[e]=Object.keys(p[e]).map((t=>({week:t,gmDollars:p[e][t].gmDollars,gmPercent:p[e][t].gmPercent/p[e][t].count})))})),console.log("formattedData",{...f}),t(f),d(Object.keys(f)[0]||"")},r.readAsArrayBuffer(l)}}),Object.keys(e).length>0&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("label",{children:"Select Store: "}),(0,c.jsx)("select",{value:a,onChange:e=>d(e.target.value),children:Object.keys(e).map((e=>{var t;return(0,c.jsx)("option",{value:e,children:null===h||void 0===h||null===(t=h.find((t=>t.ID===e)))||void 0===t?void 0:t.Label},e)}))}),(0,c.jsx)(r.bY,{options:m,style:{width:"100%",height:"95%"}})]})]})})}},1565:(e,t,a)=>{a.r(t),a.d(t,{MainWrapper:()=>m,default:()=>p});var l=a(2791),r=a(3614),n=a(9633),o=a(6934),s=a(6029),i=a(4045),c=a(4420),d=a(2643),h=a(3763),u=a(184);n.O3h.registerModules([n.wUi,n.yir,n.imY,n.ICW]);const m=(0,o.ZP)(s.Z)((()=>({width:"100%",marginLeft:"170px",height:"93%",marginTop:"60px",padding:"16px",background:"#d0d0d0"}))),p=()=>{var e,t;const a=(0,c.I0)(),[o]=(0,l.useState)(0),{calendarData:s}=(0,c.v9)((e=>e.fileData)),[p,f]=(0,l.useState)((null===(e=s[o])||void 0===e||null===(t=e.children)||void 0===t?void 0:t.map((e=>[...e.children])).flat())||[]);(0,l.useEffect)((()=>{var e,t;f((null===(e=s[o])||void 0===e||null===(t=e.children)||void 0===t?void 0:t.map((e=>[...e.children])).flat())||[])}),[s]);const y=[{headerName:"Store",field:"storeLabel",pinned:"left",width:250},{headerName:"SKU",field:"skuLabel",pinned:"left",width:250},...(null!==s&&void 0!==s?s:[]).map((e=>{var t;return{headerName:e.headerName,children:(null!==(t=e.children)&&void 0!==t?t:[]).map((e=>({headerName:e.headerName,children:[{headerName:"Sales Units",field:"SalesUnits",cellStyle:h.hD,width:130},{headerName:"Sales Dollars",field:"SalesDollar",valueFormatter:e=>"$".concat(e.value),cellStyle:h.hD,width:130},{headerName:"GM Dollars",field:"gmDollar",valueFormatter:e=>"$".concat(e.value),cellStyle:h.hD,width:130},{headerName:"GM Percent",field:"gmPercent",valueFormatter:e=>"".concat(e.value,"%"),cellStyle:h.hD,cellClassRules:h.e_,width:130}]})))}}))];return(0,u.jsx)(m,{children:(0,u.jsx)(r.s,{rowData:p,columnDefs:y,modules:[n.ICW],debug:!0,defaultColDef:h.KR,onGridReady:async()=>{try{const e=await fetch(h.Ye),t=await e.blob();if(!t)return;const l=new FileReader;l.readAsArrayBuffer(t),l.onload=e=>{var t;const l=null===(t=e.target)||void 0===t?void 0:t.result,r=i.ij(new Uint8Array(l),{type:"array"}),n=r.Sheets.Calendar,o=i.P6.sheet_to_json(n),s=r.Sheets.Planning,c=i.P6.sheet_to_json(s),h=r.Sheets.SKUs,u=i.P6.sheet_to_json(h),m={};u.forEach((e=>{let{ID:t,Label:a,Price:l,Cost:r}=e;m[t]={price:parseFloat(l),Label:a,cost:parseFloat(r)}}));const p=r.Sheets.Stores,f=i.P6.sheet_to_json(p),y={};f.forEach((e=>{let{ID:t,Label:a}=e;y[t]=a}));const g=[],v=[],S={};o.forEach((e=>{const{"Month Label":t,"Week Label":a,Week:l}=e;g.includes(t)||g.push(t),v.includes(l)||v.push(l),S[t]||(S[t]={headerName:t,children:[]});let r=S[t].children.find((e=>e.week===l));r||(r={headerName:a,week:l,children:[]},S[t].children.push(r))})),c.forEach((e=>{let{Store:t,SKU:a,Week:l,"Sales Units":r}=e;const n=m[a].price||0,o=m[a].cost||0,s=m[a].Label,i=y[t],c=n*r,d=c-r*o,h=Math.trunc(d/c*100)||0;Object.values(S).forEach((e=>{const n=e.children.find((e=>e.week===l));n&&n.children.push({Store:t,SKU:a,SalesUnits:r,SalesDollar:c.toFixed(2),skuLabel:s,storeLabel:i,gmDollar:d.toFixed(2),gmPercent:h})}))}));const b=g.map((e=>S[e])).filter(Boolean).map((e=>({...e,children:e.children.sort(((e,t)=>v.indexOf(e.week)-v.indexOf(t.week)))})));a((0,d.k2)(b))}}catch(e){console.error("Error fetching data:",e)}}})})}}}]);
//# sourceMappingURL=838.44a91fa3.chunk.js.map